name: Main2DR
on:
  push:
    tags:
      - "v*"
#  push:
 #   branches: [ "main" ]
 # pull_request:
  #  branches: [ "main" ]
#  schedule:
#    - cron: "* */2 * * *" ##Running every 15min

permissions:
  id-token: write
  contents: write
  
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    environment: myenv
    
    steps:
      # checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: 'refs/heads/main'

      - name: Read all the values from values.env and status.txt and store it in Github env variable
        run: |          
          #Read from file values.env
          while IFS='=' read -r key value; do
          echo "$key=$value" >> $GITHUB_ENV
          done < values.env
          

        
      - name: Setup JFrog CLI for SAAS main
        uses: jfrog/setup-jfrog-cli@v4
        id: setup-cli-main
        env:  
          JF_URL: ${{ env.MAINJF_URL }}
        with:
          oidc-provider-name: destgithub
          custom-server-id: ${{ env.jpdMain }}
          version: ${{ env.JFCliVersion }}
      
      - name: Download file status.txt from repo
        run: |
          jf c s 
